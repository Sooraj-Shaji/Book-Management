<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Database</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <h1>Book Database</h1>

    <div id="form-container">
      <h2>Add/Update Book</h2>
      <form id="book-form" action="">
        <input type="hidden" id="book-id">
        <label for="title">Title</label>
        <input type="text" id="title" required>
        <label for="author">Author</label>
        <input type="text" id="author" required>
        <label for="genre">Genre</label>
        <input type="text" id="genre">
        <label for="publishedYear">Published Year</label>
        <input type="number" id="publishedYear">
        <label for="description">Description</label>
        <textarea id="description"></textarea>
        <button type="submit">Submit</button>
      </form>
    </div>

    <div id="book-list-container">
      <h2>Book List</h2>
      <ul id="book-list">
      </ul>
    </div>
  </div>

  <script>
    const apiUrl = 'http://localhost:5000/api/books';

    const bookForm = document.getElementById('book-form');
    const bookList = document.getElementById('book-list');
    const bookIdInput = document.getElementById('book-id');
    const titleInput = document.getElementById('title');
    const authorInput = document.getElementById('author');
    const genreInput = document.getElementById('genre');
    const publishedYearInput = document.getElementById('publishedYear');
    const descriptionInput = document.getElementById('description');


    async function fetchBooks() {
      const response = await fetch(apiUrl);
      const books = await response.json();
      displayBooks(books);
    }

    function displayBooks(books) {
      bookList.innerHTML = '';
      books.forEach(book => {
        const li = document.createElement('li');
        li.classList.add('book-item');
        li.innerHTML = `
      <div>
        <strong>${book.title}</strong><br>
        Author: ${book.author}<br>
        Genre: ${book.genre || 'N/A'}<br>
        Published Year: ${book.publishedYear || 'N/A'}<br>
        Description: ${book.description || 'No description available'}
      </div>
      <div>
        <button onclick="editBook('${book._id}')">Edit</button>
        <button onclick="deleteBook('${book._id}')">Delete</button>
      </div>
    `;
        bookList.appendChild(li);
      });
    }

    bookForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const bookData = {
        title: titleInput.value,
        author: authorInput.value,
        genre: genreInput.value,
        publishedYear: publishedYearInput.value,
        description: descriptionInput.value,
      };

      const bookId = bookIdInput.value;
      if (bookId) {
        await updateBook(bookId, bookData);
      } else {
        await addBook(bookData);
      }

      resetForm();
      fetchBooks();
    });

    async function addBook(bookData) {
      await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(bookData),
      });
    }

    async function updateBook(bookId, bookData) {
      await fetch(`${apiUrl}/${bookId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(bookData),
      });
    }

    async function editBook(bookId) {
      const response = await fetch(`${apiUrl}/${bookId}`);
      const book = await response.json();

      bookIdInput.value = book._id;
      titleInput.value = book.title;
      authorInput.value = book.author;
      genreInput.value = book.genre;
      publishedYearInput.value = book.publishedYear;
      descriptionInput.value = book.description;
    }

    async function deleteBook(bookId) {
      await fetch(`${apiUrl}/${bookId}`, {
        method: 'DELETE',
      });
      fetchBooks();
    }

    function resetForm() {
      bookIdInput.value = '';
      titleInput.value = '';
      authorInput.value = '';
      genreInput.value = '';
      publishedYearInput.value = '';
      descriptionInput.value = '';
    }

    fetchBooks();

  </script>
</body>

</html> -->



<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book List</title>
  <link rel="stylesheet" href="/styles.css">
</head>

<body>

  <div class="add-book">
    <h3>Add a New Book</h3>
    <form id="add-book-form">
      <input type="text" id="book-title" placeholder="Title" required />
      <input type="text" id="book-author" placeholder="Author" required />
      <button type="submit">Add Book</button>
    </form>
  </div>
  <div class="container">
    <header>
      <h1>Book List</h1>
    </header>
    <main>
      <div id="book-list" class="book-list">
        <!-- Books will be dynamically inserted here -->
      </div>
      <div>
        <button type="submit">Edit list</button>
        <button type="submit">Delete list</button>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const bookList = document.getElementById('book-list');
      const addBookForm = document.getElementById('add-book-form');
      const bookTitleInput = document.getElementById('book-title');
      const bookAuthorInput = document.getElementById('book-author');

      // Fetch the books from the API
      const fetchBooks = async () => {
        try {
          const response = await fetch('http://localhost:4000/api/books');
          const books = await response.json();
          renderBooks(books);
        } catch (error) {
          console.error('Error fetching books:', error);
        }
      };

      // Render books in the DOM
      const renderBooks = (books) => {
        bookList.innerHTML = ''; // Clear current book list
        books.forEach(book => {
          const bookItem = document.createElement('div');
          bookItem.classList.add('book');
          bookItem.innerHTML = `
        <span><strong>${book.title}</strong> by ${book.author}</span>
      `;
          bookList.appendChild(bookItem);
        });
      };

      // Handle form submission to add a new book
      addBookForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const title = bookTitleInput.value;
        const author = bookAuthorInput.value;

        try {
          await fetch('http://localhost:4000/api/books', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ title, author }),
          });

          // Clear form and fetch updated book list
          bookTitleInput.value = '';
          bookAuthorInput.value = '';
          fetchBooks();
        } catch (error) {
          console.error('Error adding book:', error);
        }
      });

      const handleEdit = (event) => {
        const bookId = event.target.dataset.id;

        // Fetch book details by ID
        fetch(`http://localhost:4000/api/books/${bookId}`)
          .then(response => response.json())
          .then(book => {
            bookTitleInput.value = book.title;
            bookAuthorIdInput.value = book.author._id;

            // Modify the form submission to update the book
            addBookForm.onsubmit = async (e) => {
              e.preventDefault();

              const title = bookTitleInput.value;
              const authorId = bookAuthorIdInput.value;

              try {
                await fetch(`http://localhost:4000/api/books/${bookId}`, {
                  method: 'PUT',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ title, authorId }),
                });

                // Clear the form and refresh book list
                bookTitleInput.value = '';
                bookAuthorIdInput.value = '';
                fetchBooks();
              } catch (error) {
                console.error('Error updating book:', error);
              }
            };
          })
          .catch(error => console.error('Error fetching book details:', error));
      };

      // Handle deleting a book
      const handleDelete = (event) => {
        const bookId = event.target.dataset.id;

        if (confirm('Are you sure you want to delete this book?')) {
          fetch(`http://localhost:4000/api/books/${bookId}`, {
            method: 'DELETE',
          })
            .then(response => response.json())
            .then(() => {
              fetchBooks();  // Refresh the book list after deletion
            })
            .catch(error => console.error('Error deleting book:', error));
        }
      };

      // Initial fetch of books when page loads
      fetchBooks();
    });

  </script>
</body>

</html>